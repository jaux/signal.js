/*
 * SignalJS - Signals and Slots in JavaScript
 *
 * Version:  0.0.1
 * License:  BSD
 * Build on: Sun 30 Dec 2012 11:44:37 UTC
 *
 * Copyright (c) 2012 Ye Liu
 */
(function(j){var q=j.Signal,d=j.Signal={__version__:"0.0.1",__license__:"BSD",__author__:"Ye Liu",__contact__:"yeliu@instast.com",__copyright__:"Copyright (c) 2012 Ye Liu"};d.noConflict=function(){j.Signal=q;return this};d.allowDuplicateSlots=!1;d.isSenderCompatible=function(a,b){return void 0!==a&&null!==a?a===b:!0};var r=function(){},h=Object.prototype.toString,i="[object Object]"===h.call(null)?function(a){return null!==a&&void 0!==a&&"[object Object]"===h.call(a)}:function(a){return"[object Object]"===
h.call(a)},k=void 0!==document&&"function"===typeof document.getElementsByTagName("body")?function(a){return"[object Function]"===h.call(a)}:function(a){return"function"===typeof a},n=function(a){for(var b=[],a=a||[],c=0;c<a.length;c++)b[c]=a[c];return b},s=1,p=d.markObj=function(a){i(a)&&!a._signalObjId&&(a._signalObjId=s++);return a};d.unmarkObj=function(a){i(a)&&delete a._signalObjId;return a};var l=function(a,b){return i(a)&&i(b)&&a._signalObjId&&b._signalObjId?a._signalObjId===b._signalObjId:
a===b},t=0,e=d.Slot=function(a,b,c){this.id=t++;this._fn=a||r;this._receiver=b||null;this._sender=c||null};e.prototype.call=function(){return this._fn.apply(this._receiver,arguments)};e.prototype.isEqual=function(a){return this.compare(a,l,l)};e.prototype.isCompatible=function(a){return this.compare(a,l,d.isSenderCompatible)};e.prototype.isSenderCompatible=function(a){var b=d.isSenderCompatible;return k(b)?b(this._sender,a):this._sender===a};e.prototype.compare=function(a,b,c){return!(a instanceof
e)?!1:this===a||this.id===a.id?!0:this._fn!==a._fn||k(b)&&!b(this._receiver,a._receiver)||k(c)&&!c(this._sender,a._sender)?!1:!0};var f=d.BaseSignal=function(){this.slots=[]};f.prototype.connect=function(a,b,c){p(b);p(c);a=new e(a,b,c);if(!d.allowDuplicateSlots)for(b=this.slots.length-1;0<=b;b--)if(this.slots[b].isEqual(a))return this.slots[b];this.slots.push(a);return a};f.prototype.emit=function(a){for(var b,c=0;c<this.slots.length;c++)b=this.slots[c],b.isSenderCompatible(a)&&b.call.apply(b,arguments)};
f.prototype.asyncEmit=function(a){var b=this,c=arguments;setTimeout(function(){b.emit.apply(b,c)},1)};f.prototype.disconnect=function(a,b,c){return this.disconnectBySlot(new e(a,b,c))};f.prototype.disconnectBySlot=function(a){for(var b=0,c=null;b<this.slots.length;)this.slots[b].isEqual(a)?c=this.slots.splice(b,1):b++;return c?c[0]:null};var m={},g=d.create=function(a){var b=null;return void 0===a||null===a?b:b=a in m?m[a]:m[a]=new f};d.connect=function(a,b,c,d){return(a=g(a))?a.connect(b,c,d):null};
d.disconnect=function(a,b,c,d){return(a=g(a))?a.disconnect(b,c,d):null};d.disconnectBySlot=function(a,b){var c=g(a);return c?c.disconnectBySlot(b):null};d.emit=function(a){var b=g(a),c;b&&(c=n(arguments),c.shift(),b.emit.apply(b,c))};d.asyncEmit=function(a){var b=g(a),c;b&&(c=n(arguments),c.shift(),b.asyncEmit.apply(b,c))}})(this);
